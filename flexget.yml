web_server: yes

schedules:
  - tasks: '*'
    interval:
      minutes: 5

templates:
  # INPUTS - TEMPLATES TO BE USED IN OTHER TEMPLATES

  # Exponential backoff for failed entries
  retry: &retry
    retry_failed:
      retry_time: 30 minutes
      retry_time_multiplier: 1.5
      max_retries: 100

  # Base configuration for output lists
  output-list: &output-list
    priority: 1
    accept_all: yes

  # INPUTS - TEMPLATES TO BE USED IN TASKS

  # Aggregate TV from input tasks
  output-list-tv:
    <<: *retry
    <<: *output-list
    list_add:
      entry_list: tv
  input-list-tv:
    entry_list: tv

  # Aggregate movies from input tasks
  output-list-movies:
    <<: *retry
    <<: *output-list
    list_add:
      entry_list: movies
  input-list-movies:
    entry_list: movies

  # FILTER - TEMPLATES TO BE USED IN OTHER TEMPLATES

  # Convert magnet links to torrent files
  convert-magnet: &convert-magnet
    convert_magnet:
      timeout: 60 seconds

  # Reject entries containing archive files
  reject-archives: &reject-archives
    <<: *convert-magnet
    magnets: no
    content_filter:
      reject:
        - '*.rar'
        - '*.zip'

  # FILTER - TEMPLATES TO BE USED IN TASKS

  tv:
    <<: *reject-archives
    quality: 480p webrip+ h264

  movies:
    <<: *reject-archives
    quality: 1080p webdl+ h264
    upgrade:
      target: 1080p webdl+ h264
      propers: yes

  qbittorrent:
    qbittorrent:
      host: localhost
      port: 8080
      username: admin
      password: adminadmin
      label: flexget

tasks:
  # TV - FETCH INPUTS TO LIST

  rss-tv-eztv:
    templates:
      - output-list-tv
    rss: https://eztv.io/ezrss.xml

  rss-tv-rarbg:
    templates:
      - output-list-tv
    rss: https://rarbg.to/rssdd.php?category=2;18;41;49

  rss-tv-limetorrents:
    templates:
      - output-list-tv
    rss: https://www.limetorrents.info/rss/20/

  # MOVIES - FETCH INPUTS TO LIST

  rss-movies-rarbg:
    templates:
      - output-list-movies
    rss: https://rarbg.to/rssdd.php?category=movies
    regexp:
      reject_excluding:
        - RARBG

  rss-movies-yify:
    templates:
      - output-list-movies
    rss: https://yts.ag/rss/0/all/all/0

  rss-movies-limetorrents:
    templates:
      - output-list-movies
    rss: https://www.limetorrents.info/rss/16/

  # TV - FILTER LISTS

  download-tv:
    templates:
      - input-list-tv
      - tv
    # TODO: SERIES PLUGIN AND TORRENT
  
  # MOVIES - FILTER LISTS

  download-movies-imdb-watchlist:
    templates:
      - input-list-movies
      - movies
      - qbittorrent
    imdb_lookup: yes
    require_field: imdb_id
    crossmatch:
      from:
        - imdb_list:
            login: ...
            password: ...
            list: watchlist
      fields:
        - imdb_id
      action: accept

  download-movies-imdb:
    templates:
      - input-list-movies
      - movies
      - qbittorrent
    imdb_lookup: yes
    require_field: imdb_id
    imdb:
      min_score: 7.5
      min_votes: 1000
